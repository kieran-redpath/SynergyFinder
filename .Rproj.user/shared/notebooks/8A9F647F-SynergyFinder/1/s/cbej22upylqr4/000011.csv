"0","# Create an empty list to enter data into"
"0","synergy.response.data <- list()"
"0","# Extract rows of values you've actually tested in the lab: removing the imputed values where n = 1"
"0","# First extract response information (calculated mean from replicates and other statistics)"
"0","tmp <- synergy.score[[""response_statistics""]][which(synergy.score[[""response_statistics""]]$n > 1),]"
"0","# Remove NAs - not sure if this line is necessary (or it might break stuff)"
"0","tmp <- na.omit(synergy.score[[""response_statistics""]])"
"0","# Combine this with synergy scores (calculated mean and other statistics)"
"0","tmp <- merge(tmp, synergy.score[[""synergy_scores_statistics""]],"
"0","             by = c(""block_id"", ""conc1"", ""conc2""),"
"0","             sort = F)"
"0",""
"0","# Add all of these values into a list that contains each combination/blocks data as a separate element"
"0","for(x in unique(tmp$block_id)){"
"0","  # Define the drug combination for this block"
"0","  block = synergy.score[[""drug_pairs""]]$block_id[x]"
"0","  drug1 = synergy.score[[""drug_pairs""]]$drug1[x]"
"0","  drug2 = synergy.score[[""drug_pairs""]]$drug2[x]"
"0","  synergy.response.data[[x]] <- tmp[tmp$block_id == x,]"
"0","  "
"0","  # Move single drug response data into new columns"
"0","  # Create new columns for response and sem for drug 1"
"0","  synergy.response.data[[x]][, paste0(drug1, ""_response"")] <- NA"
"0","  synergy.response.data[[x]][, paste0(drug1, ""_sem"")] <- NA"
"0","  # Create new columns for response and sem for drug 2"
"0","  synergy.response.data[[x]][, paste0(drug2, ""_response"")] <- NA"
"0","  synergy.response.data[[x]][, paste0(drug2, ""_sem"")] <- NA"
"0","  "
"0","  # Move response values for drug 1 into a new column for readability"
"0","  # Define the value of y and remove 0's"
"0","  y <- unique(synergy.response.data[[x]]$conc1)"
"0","  y <- y[! y %in% ""0""]"
"0","  # Move values from ""response"" to ""drug1_response"" based on conditions"
"0","  for(z in 1:length(y)){"
"0","    synergy.response.data[[x]][, paste0(drug1, ""_response"")][synergy.response.data[[x]]$conc1 == y[z]] <- synergy.response.data[[x]]$response_mean[synergy.response.data[[x]]$conc1 == y[z] & synergy.response.data[[x]]$conc2 == 0]"
"0","  }"
"0","  # Do the same for ""response_sem"""
"0","  for(z in 1:length(y)){"
"0","    synergy.response.data[[x]][, paste0(drug1, ""_sem"")][synergy.response.data[[x]]$conc1 == y[z]] <- synergy.response.data[[x]]$response_sem[synergy.response.data[[x]]$conc1 == y[z] & synergy.response.data[[x]]$conc2 == 0]"
"0","  }"
"0","  "
"0","  # Move response values for drug 2 into a new column for readability"
"0","  # Define the value of y and remove 0's"
"0","  y <- unique(synergy.response.data[[x]]$conc2)"
"0","  y <- y[! y %in% ""0""]"
"0","  # Move values from ""response"" to ""drug2_response"" based on conditions"
"0","  for(z in 1:length(y)){"
"0","    synergy.response.data[[x]][, paste0(drug2, ""_response"")][synergy.response.data[[x]]$conc2 == y[z]] <- synergy.response.data[[x]]$response_mean[synergy.response.data[[x]]$conc2 == y[z] & synergy.response.data[[x]]$conc1 == 0]"
"0","  }"
"0","  # Do the same for ""response_sem"""
"0","  for(z in 1:length(y)){"
"0","    synergy.response.data[[x]][, paste0(drug2, ""_sem"")][synergy.response.data[[x]]$conc2 == y[z]] <- synergy.response.data[[x]]$response_sem[synergy.response.data[[x]]$conc2 == y[z] & synergy.response.data[[x]]$conc1 == 0]"
"0","  }"
"0","  "
"0","  # Remove extra rows"
"0","  synergy.response.data[[x]] <- synergy.response.data[[x]][!synergy.response.data[[x]]$conc1 == 0, ]"
"0","  synergy.response.data[[x]] <- synergy.response.data[[x]][!synergy.response.data[[x]]$conc2 == 0, ]"
"0","  "
"0","  # Define which columns you want to keep - currently this is designed for simplicity and only includes standard error of the mean (but this should probably actually be standard deviation)"
"0","  keep.columns <- c(""conc1"", ""conc2"","
"0","                    paste0(drug1, ""_response""), paste0(drug1, ""_sem""),"
"0","                    paste0(drug2, ""_response""), paste0(drug2, ""_sem""),"
"0","                    ""response_mean"", ""response_sem"","
"0","                    paste0(synergy.type, ""_synergy_mean""), paste0(synergy.type, ""_synergy_sem""))"
"0","  synergy.response.data[[x]] <- synergy.response.data[[x]][, keep.columns]"
"0","  "
"0","  # Rename rows for readability and plotting"
"0","  combo.names <- paste0(drug1, ""_"","
"0","                        synergy.response.data[[x]]$conc1, dose.response.mat[[""drug_pairs""]][[""conc_unit2""]][x],"
"0","                        ""_X_"", drug2, ""_"","
"0","                        synergy.response.data[[x]]$conc2, dose.response.mat[[""drug_pairs""]][[""conc_unit2""]][x])"
"0","  rownames(synergy.response.data[[x]]) <- combo.names"
"0","  # Rename some columns for readability and plotting"
"0","  synergy.response.data[[x]] <- synergy.response.data[[x]] %>% rename("
"0","    !!paste0(drug1, ""_conc"") := ""conc1"","
"0","    !!paste0(drug2, ""_conc"") := ""conc2"","
"0","    ""Combo_response"" = ""response_mean"","
"0","    ""Combo_sem"" = ""response_sem"")"
"0","  # Rename each list element"
"0","  names(synergy.response.data)[x] <- paste0(synergy.type, ""_block"", ""_"", x, ""_"", drug1, ""_X_"", drug2)"
"0","}"
"0","# Print or do further processing with new_data"
"0",""
"0","# Clean up environment"
"0","rm(""tmp"",""block"", ""drug1"", ""drug2"", ""combo.names"", ""keep.columns"", ""x"", ""y"", ""z"")"
